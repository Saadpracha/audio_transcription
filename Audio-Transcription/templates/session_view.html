<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Session {{ session_id }}</title>
    <link rel="stylesheet" href="/static/style.css" />
</head>
<body>
    <div class="container">
        <header>
            <h1>Session {{ session_id }}</h1>
            <p class="subtitle">Transcript, Summary, and Action Items</p>
        </header>

        <section>
            <h2>Summary</h2>
            {% if summary %}
                {% set sum_text = summary.get('summary') or summary.get('summary_text') or summary %}
                {% if sum_text is string %}
                    <p>{{ sum_text }}</p>
                {% else %}
                    <pre class="json-block">{{ sum_text | tojson(indent=2) }}</pre>
                {% endif %}
                {% if summary.get('key_points') %}
                    <ul>
                        {% for pt in summary.get('key_points') %}
                            <li>{{ pt }}</li>
                        {% endfor %}
                    </ul>
                {% endif %}
            {% else %}
                <p class="muted">Not available</p>
            {% endif %}
        </section>

        <section>
            <h2>Call To Action</h2>
            {% if call_to_action %}
                {% set items = call_to_action.get('call_to_action') or call_to_action.get('call_to_action_items') or [] %}
                {% if items %}
                    <ul class="checklist">
                        {% for item in items %}
                            <li>
                                <input type="checkbox" disabled />
                                <span class="item">{{ item.get('item') or item }}</span>
                                {% if item.get('owner') %}<span class="meta">Owner: {{ item.get('owner') }}</span>{% endif %}
                                {% if item.get('due') %}<span class="meta">Due: {{ item.get('due') }}</span>{% endif %}
                            </li>
                        {% endfor %}
                    </ul>
                {% else %}
                    <p class="muted">No action items found</p>
                {% endif %}
            {% else %}
                <p class="muted">Not available</p>
            {% endif %}
        </section>

        <section>
            <h2>Transcript</h2>
            {% if transcript %}
                {% set segs = transcript.get('segments') or [] %}
                {% if segs %}
                    <div class="transcript">
                        {% for seg in segs %}
                            <div class="seg">
                                <span class="time">[{{ '%.2f' % (seg.get('start') or 0) }}]</span>
                                <span class="speaker">{{ seg.get('speaker') or 'SPEAKER' }}</span>:
                                <span class="text">{{ seg.get('text') }}</span>
                            </div>
                        {% endfor %}
                    </div>
                {% else %}
                    <pre class="json-block">{{ transcript | tojson(indent=2) }}</pre>
                {% endif %}
            {% else %}
                <p class="muted">Not available</p>
            {% endif %}
        </section>

        <section>
            <h2>Prompt</h2>
            {% if prompt %}
                <pre class="json-block">{{ prompt | tojson(indent=2) }}</pre>
            {% else %}
                <p class="muted">Not available</p>
            {% endif %}
        </section>

        <section>
            <h2>Raw Files</h2>
            <ul>
                <li>Summary: {% if urls.summary %}<a href="{{ urls.summary }}" target="_blank">Open</a>{% else %}<span class="muted">Not available</span>{% endif %}</li>
                <li>Transcript: {% if urls.transcript %}<a href="{{ urls.transcript }}" target="_blank">Open</a>{% else %}<span class="muted">Not available</span>{% endif %}</li>
                <li>Call To Action: {% if urls.call_to_action %}<a href="{{ urls.call_to_action }}" target="_blank">Open</a>{% else %}<span class="muted">Not available</span>{% endif %}</li>
                <li>Prompt: {% if urls.prompt %}<a href="{{ urls.prompt }}" target="_blank">Open</a>{% else %}<span class="muted">Not available</span>{% endif %}</li>
            </ul>
        </section>

        <footer>
            <p class="muted">Generated by Audio Transcription Service</p>
        </footer>
    </div>
</body>
</html>

